<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Composing Models and Building Reusable Components · ModelingToolkit.jl</title><meta name="title" content="Composing Models and Building Reusable Components · ModelingToolkit.jl"/><meta property="og:title" content="Composing Models and Building Reusable Components · ModelingToolkit.jl"/><meta property="twitter:title" content="Composing Models and Building Reusable Components · ModelingToolkit.jl"/><meta name="description" content="Documentation for ModelingToolkit.jl."/><meta property="og:description" content="Documentation for ModelingToolkit.jl."/><meta property="twitter:description" content="Documentation for ModelingToolkit.jl."/><meta property="og:url" content="https://docs.sciml.ai/ModelingToolkit/stable/basics/Composition/"/><meta property="twitter:url" content="https://docs.sciml.ai/ModelingToolkit/stable/basics/Composition/"/><link rel="canonical" href="https://docs.sciml.ai/ModelingToolkit/stable/basics/Composition/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ModelingToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ModelingToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../tutorials/ode_modeling/">Getting Started with ModelingToolkit.jl</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/acausal_components/">Acausal Component-Based Modeling</a></li><li><a class="tocitem" href="../../tutorials/nonlinear/">Modeling Nonlinear Systems</a></li><li><a class="tocitem" href="../../tutorials/initialization/">Initialization of ODESystems</a></li><li><a class="tocitem" href="../../tutorials/optimization/">Modeling Optimization Problems</a></li><li><a class="tocitem" href="../../tutorials/modelingtoolkitize/">Modelingtoolkitize: Automatically Translating Numerical to Symbolic Code</a></li><li><a class="tocitem" href="../../tutorials/programmatically_generating/">Programmatically Generating and Scripting ODESystems</a></li><li><a class="tocitem" href="../../tutorials/stochastic_diffeq/">Modeling with Stochasticity</a></li><li><a class="tocitem" href="../../tutorials/discrete_system/">(Experimental) Modeling Discrete Systems</a></li><li><a class="tocitem" href="../../tutorials/parameter_identifiability/">Parameter Identifiability in ODE Models</a></li><li><a class="tocitem" href="../../tutorials/change_independent_variable/">Changing the independent variable of ODEs</a></li><li><a class="tocitem" href="../../tutorials/bifurcation_diagram_computation/">Bifurcation Diagrams</a></li><li><a class="tocitem" href="../../tutorials/SampledData/">Clocks and Sampled-Data Systems</a></li><li><a class="tocitem" href="../../tutorials/domain_connections/">Domains</a></li><li><a class="tocitem" href="../../tutorials/callable_params/">Callable parameters and interpolating data</a></li><li><a class="tocitem" href="../../tutorials/linear_analysis/">Linear Analysis</a></li><li><a class="tocitem" href="../../tutorials/fmi/">Importing FMUs</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Basic Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/higher_order/">Automatic Transformation of Nth Order ODEs to 1st Order ODEs</a></li><li><a class="tocitem" href="../../examples/spring_mass/">Component-Based Modeling of a Spring-Mass System</a></li><li><a class="tocitem" href="../../examples/modelingtoolkitize_index_reduction/">Automated Index Reduction of DAEs</a></li><li><a class="tocitem" href="../../examples/remake/">Optimizing through an ODE solve and re-creating MTK Problems</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Advanced Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/tearing_parallelism/">Exposing More Parallelism By Tearing Algebraic Equations in ODESystems</a></li><li><a class="tocitem" href="../../examples/sparse_jacobians/">Automated Sparse Analytical Jacobians</a></li><li><a class="tocitem" href="../../examples/perturbation/">Symbolic-Numeric Perturbation Theory for ODEs</a></li></ul></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../AbstractSystem/">The AbstractSystem Interface</a></li><li><a class="tocitem" href="../ContextualVariables/">Contextual Variable Types</a></li><li><a class="tocitem" href="../Variable_metadata/">Symbolic Metadata</a></li><li class="is-active"><a class="tocitem" href>Composing Models and Building Reusable Components</a><ul class="internal"><li><a class="tocitem" href="#Simple-Model-Composition-Example"><span>Simple Model Composition Example</span></a></li><li><a class="tocitem" href="#Basics-of-Model-Composition"><span>Basics of Model Composition</span></a></li><li><a class="tocitem" href="#Structural-Simplify"><span>Structural Simplify</span></a></li><li><a class="tocitem" href="#Inheritance-and-Combine"><span>Inheritance and Combine</span></a></li><li><a class="tocitem" href="#Tearing-Problem-Construction"><span>Tearing Problem Construction</span></a></li><li><a class="tocitem" href="#Components-with-discontinuous-dynamics"><span>Components with discontinuous dynamics</span></a></li></ul></li><li><a class="tocitem" href="../Events/">Event Handling and Callback Functions</a></li><li><a class="tocitem" href="../Linearization/">Linearization</a></li><li><a class="tocitem" href="../InputOutput/">Input output</a></li><li><a class="tocitem" href="../MTKLanguage/">ModelingToolkit Language: Modeling with <code>@mtkmodel</code>, <code>@connectors</code> and <code>@mtkbuild</code></a></li><li><a class="tocitem" href="../Validation/">Model Validation and Units</a></li><li><a class="tocitem" href="../Debugging/">Debugging</a></li><li><a class="tocitem" href="../DependencyGraphs/">Dependency Graphs</a></li><li><a class="tocitem" href="../Precompilation/">Working with Precompilation and Binary Building</a></li><li><a class="tocitem" href="../FAQ/">Frequently Asked Questions</a></li></ul></li><li><span class="tocitem">System Types</span><ul><li><a class="tocitem" href="../../systems/ODESystem/">ODESystem</a></li><li><a class="tocitem" href="../../systems/SDESystem/">SDESystem</a></li><li><a class="tocitem" href="../../systems/JumpSystem/">JumpSystem</a></li><li><a class="tocitem" href="../../systems/NonlinearSystem/">NonlinearSystem</a></li><li><a class="tocitem" href="../../systems/OptimizationSystem/">OptimizationSystem</a></li><li><a class="tocitem" href="../../systems/PDESystem/">PDESystem</a></li><li><a class="tocitem" href="../../systems/DiscreteSystem/">DiscreteSystem</a></li><li><a class="tocitem" href="../../systems/ImplicitDiscreteSystem/">ImplicitDiscreteSystem</a></li></ul></li><li><a class="tocitem" href="../../comparison/">Comparison of ModelingToolkit vs Equation-Based and Block Modeling Languages</a></li><li><a class="tocitem" href="../../internals/">Internal Details</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Basics</a></li><li class="is-active"><a href>Composing Models and Building Reusable Components</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Composing Models and Building Reusable Components</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/ModelingToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/ModelingToolkit.jl/blob/master/docs/src/basics/Composition.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="components"><a class="docs-heading-anchor" href="#components">Composing Models and Building Reusable Components</a><a id="components-1"></a><a class="docs-heading-anchor-permalink" href="#components" title="Permalink"></a></h1><p>The symbolic models of ModelingToolkit can be composed together to easily build large models. The composition is lazy and only instantiated at the time of conversion to numerical models, allowing a more performant way in terms of computation time and memory.</p><h2 id="Simple-Model-Composition-Example"><a class="docs-heading-anchor" href="#Simple-Model-Composition-Example">Simple Model Composition Example</a><a id="Simple-Model-Composition-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-Model-Composition-Example" title="Permalink"></a></h2><p>The following is an example of building a model in a library with an optional forcing function, and allowing the user to specify the forcing later. Here, the library author defines a component named <code>decay</code>. The user then builds two <code>decay</code> components and connects them, saying the forcing term of <code>decay1</code> is a constant while the forcing term of <code>decay2</code> is the value of the unknown variable <code>x</code>.</p><pre><code class="language-julia hljs">using ModelingToolkit
using ModelingToolkit: t_nounits as t, D_nounits as D

function decay(; name)
    @parameters a
    @variables x(t) f(t)
    ODESystem([
            D(x) ~ -a * x + f
        ], t;
        name = name)
end

@named decay1 = decay()
@named decay2 = decay()

connected = compose(
    ODESystem([decay2.f ~ decay1.x
               D(decay1.f) ~ 0], t; name = :connected), decay1, decay2)

equations(connected)

#4-element Vector{Equation}:
# Differential(t)(decay1₊f(t)) ~ 0
# decay2₊f(t) ~ decay1₊x(t)
# Differential(t)(decay1₊x(t)) ~ decay1₊f(t) - (decay1₊a*(decay1₊x(t)))
# Differential(t)(decay2₊x(t)) ~ decay2₊f(t) - (decay2₊a*(decay2₊x(t)))

simplified_sys = structural_simplify(connected)

equations(simplified_sys)</code></pre><p class="math-container">\[ \begin{align}
\frac{\mathrm{d} \mathtt{decay1.f}\left( t \right)}{\mathrm{d}t} &amp;= -0 \\
\frac{\mathrm{d} \mathtt{decay1.x}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{decay1.f}\left( t \right) - \mathtt{decay1.a} \mathtt{decay1.x}\left( t \right) \\
\frac{\mathrm{d} \mathtt{decay2.x}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{decay2.f}\left( t \right) - \mathtt{decay2.a} \mathtt{decay2.x}\left( t \right)
\end{align}
 \]</p><p>Now we can solve the system:</p><pre><code class="language-julia hljs">x0 = [decay1.x =&gt; 1.0
      decay1.f =&gt; 0.0
      decay2.x =&gt; 1.0]
p = [decay1.a =&gt; 0.1
     decay2.a =&gt; 0.2]

using OrdinaryDiffEq
prob = ODEProblem(simplified_sys, x0, (0.0, 100.0), p)
sol = solve(prob, Tsit5())
sol[decay2.f]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">23-element Vector{Float64}:
 1.0
 0.988412780354162
 0.9276920395695476
 0.8308344244566978
 0.7238510955866865
 0.6064716164166943
 0.4906266552035331
 0.3812369181842624
 0.2840663665253936
 0.20250581169194393
 ⋮
 0.016682567149343432
 0.008438450419997945
 0.004154118347787677
 0.001992944924601996
 0.0009349149704511695
 0.0004281898151485484
 0.00019123717408380005
 8.298369553975039e-5
 4.542765616410232e-5</code></pre><h2 id="Basics-of-Model-Composition"><a class="docs-heading-anchor" href="#Basics-of-Model-Composition">Basics of Model Composition</a><a id="Basics-of-Model-Composition-1"></a><a class="docs-heading-anchor-permalink" href="#Basics-of-Model-Composition" title="Permalink"></a></h2><p>Every <code>AbstractSystem</code> has a <code>system</code> keyword argument for specifying subsystems. A model is the composition of itself and its subsystems. For example, if we have:</p><pre><code class="language-julia hljs">@named sys = compose(ODESystem(eqs, indepvar, unknowns, ps), subsys)</code></pre><p>the <code>equations</code> of <code>sys</code> is the concatenation of <code>get_eqs(sys)</code> and <code>equations(subsys)</code>, the unknowns are the concatenation of their unknowns, etc. When the <code>ODEProblem</code> or <code>ODEFunction</code> is generated from this system, it will build and compile the functions associated with this composition.</p><p>The new equations within the higher level system can access the variables in the lower level system by namespacing via the <code>nameof(subsys)</code>. For example, let&#39;s say there is a variable <code>x</code> in <code>unknowns</code> and a variable <code>x</code> in <code>subsys</code>. We can declare that these two variables are the same by specifying their equality: <code>x ~ subsys.x</code> in the <code>eqs</code> for <code>sys</code>. This algebraic relationship can then be simplified by transformations like <code>structural_simplify</code> which will be described later.</p><h3 id="Numerics-with-Composed-Models"><a class="docs-heading-anchor" href="#Numerics-with-Composed-Models">Numerics with Composed Models</a><a id="Numerics-with-Composed-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Numerics-with-Composed-Models" title="Permalink"></a></h3><p>These composed models can then be directly transformed into their associated <code>SciMLProblem</code> type using the standard constructors. When this is done, the initial conditions and parameters must be specified in their namespaced form. For example:</p><pre><code class="language-julia hljs">u0 = [x =&gt; 2.0
      subsys.x =&gt; 2.0]</code></pre><p>Note that any default values within the given subcomponent will be used if no override is provided at construction time. If any values for initial conditions or parameters are unspecified, an error will be thrown.</p><p>When the model is numerically solved, the solution can be accessed via its symbolic values. For example, if <code>sol</code> is the <code>ODESolution</code>, one can use <code>sol[x]</code> and <code>sol[subsys.x]</code> to access the respective timeseries in the solution. All other indexing rules stay the same, so <code>sol[x,1:5]</code> accesses the first through fifth values of <code>x</code>. Note that this can be done even if the variable <code>x</code> is eliminated from the system from transformations like <code>alias_elimination</code> or <code>tearing</code>: the variable will be lazily reconstructed on demand.</p><h3 id="Variable-scope-and-parameter-expressions"><a class="docs-heading-anchor" href="#Variable-scope-and-parameter-expressions">Variable scope and parameter expressions</a><a id="Variable-scope-and-parameter-expressions-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-scope-and-parameter-expressions" title="Permalink"></a></h3><p>In some scenarios, it could be useful for model parameters to be expressed in terms of other parameters, or shared between common subsystems. To facilitate this, ModelingToolkit supports symbolic expressions in default values, and scoped variables.</p><p>With symbolic parameters, it is possible to set the default value of a parameter or initial condition to an expression of other variables.</p><pre><code class="language-julia hljs"># ...
sys = ODESystem(
# ...
# directly in the defaults argument
    defaults = Pair{Num, Any}[x =&gt; u,
    y =&gt; σ,
    z =&gt; u - 0.1])
# by assigning to the parameter
sys.y = u * 1.1</code></pre><p>In a hierarchical system, variables of the subsystem get namespaced by the name of the system they are in. This prevents naming clashes, but also enforces that every unknown and parameter is local to the subsystem it is used in. In some cases it might be desirable to have variables and parameters that are shared between subsystems, or even global. This can be accomplished as follows.</p><pre><code class="language-julia hljs">@parameters a b c d e f

# a is a local variable
b = ParentScope(b) # b is a variable that belongs to one level up in the hierarchy
c = ParentScope(ParentScope(c)) # ParentScope can be nested
d = DelayParentScope(d) # skips one level before applying ParentScope
e = DelayParentScope(e, 2) # second argument allows skipping N levels
f = GlobalScope(f)

p = [a, b, c, d, e, f]

level0 = ODESystem(Equation[], t, [], p; name = :level0)
level1 = ODESystem(Equation[], t, [], []; name = :level1) ∘ level0
parameters(level1)
#level0₊a
#b
#c
#level0₊d
#level0₊e
#f
level2 = ODESystem(Equation[], t, [], []; name = :level2) ∘ level1
parameters(level2)
#level1₊level0₊a
#level1₊b
#c
#level0₊d
#level1₊level0₊e
#f
level3 = ODESystem(Equation[], t, [], []; name = :level3) ∘ level2
parameters(level3)
#level2₊level1₊level0₊a
#level2₊level1₊b
#level2₊c
#level2₊level0₊d
#level1₊level0₊e
#f</code></pre><h2 id="Structural-Simplify"><a class="docs-heading-anchor" href="#Structural-Simplify">Structural Simplify</a><a id="Structural-Simplify-1"></a><a class="docs-heading-anchor-permalink" href="#Structural-Simplify" title="Permalink"></a></h2><p>In many cases, the nicest way to build a model may leave a lot of unnecessary variables. Thus one may want to remove these equations before numerically solving. The <code>structural_simplify</code> function removes these trivial equality relationships and trivial singularity equations, i.e. equations which result in <code>0~0</code> expressions, in over-specified systems.</p><h2 id="Inheritance-and-Combine"><a class="docs-heading-anchor" href="#Inheritance-and-Combine">Inheritance and Combine</a><a id="Inheritance-and-Combine-1"></a><a class="docs-heading-anchor-permalink" href="#Inheritance-and-Combine" title="Permalink"></a></h2><p>Model inheritance can be done in two ways: implicitly or explicitly. First, one can use the <code>extend</code> function to extend a base model with another set of equations, unknowns, and parameters. An example can be found in the <a href="../../tutorials/acausal_components/#acausal">acausal components tutorial</a>.</p><p>The explicit way is to shadow variables with equality expressions. For example, let&#39;s assume we have three separate systems which we want to compose to a single one. This is how one could explicitly forward all unknowns and parameters to the higher level system:</p><pre><code class="language-julia hljs">using ModelingToolkit, OrdinaryDiffEq, Plots
using ModelingToolkit: t_nounits as t, D_nounits as D

## Library code
@variables S(t), I(t), R(t)
N = S + I + R
@parameters β, γ

@named seqn = ODESystem([D(S) ~ -β * S * I / N], t)
@named ieqn = ODESystem([D(I) ~ β * S * I / N - γ * I], t)
@named reqn = ODESystem([D(R) ~ γ * I], t)

sir = compose(
    ODESystem(
        [
            S ~ ieqn.S,
            I ~ seqn.I,
            R ~ ieqn.R,
            ieqn.S ~ seqn.S,
            seqn.I ~ ieqn.I,
            seqn.R ~ reqn.R,
            ieqn.R ~ reqn.R,
            reqn.I ~ ieqn.I],
        t,
        [S, I, R],
        [β, γ],
        defaults = [seqn.β =&gt; β
                    ieqn.β =&gt; β
                    ieqn.γ =&gt; γ
                    reqn.γ =&gt; γ], name = :sir),
    seqn,
    ieqn,
    reqn)</code></pre><p class="math-container">\[ \begin{align}
S\left( t \right) &amp;= \mathtt{ieqn.S}\left( t \right) \\
I\left( t \right) &amp;= \mathtt{seqn.I}\left( t \right) \\
R\left( t \right) &amp;= \mathtt{ieqn.R}\left( t \right) \\
\mathtt{ieqn.S}\left( t \right) &amp;= \mathtt{seqn.S}\left( t \right) \\
\mathtt{seqn.I}\left( t \right) &amp;= \mathtt{ieqn.I}\left( t \right) \\
\mathtt{seqn.R}\left( t \right) &amp;= \mathtt{reqn.R}\left( t \right) \\
\mathtt{ieqn.R}\left( t \right) &amp;= \mathtt{reqn.R}\left( t \right) \\
\mathtt{reqn.I}\left( t \right) &amp;= \mathtt{ieqn.I}\left( t \right) \\
\frac{\mathrm{d} \mathtt{seqn.S}\left( t \right)}{\mathrm{d}t} &amp;= \frac{ - \mathtt{seqn.\beta} \mathtt{seqn.S}\left( t \right) \mathtt{seqn.I}\left( t \right)}{\mathtt{seqn.S}\left( t \right) + \mathtt{seqn.I}\left( t \right) + \mathtt{seqn.R}\left( t \right)} \\
\frac{\mathrm{d} \mathtt{ieqn.I}\left( t \right)}{\mathrm{d}t} &amp;= \frac{\mathtt{ieqn.\beta} \mathtt{ieqn.S}\left( t \right) \mathtt{ieqn.I}\left( t \right)}{\mathtt{ieqn.S}\left( t \right) + \mathtt{ieqn.I}\left( t \right) + \mathtt{ieqn.R}\left( t \right)} - \mathtt{ieqn.\gamma} \mathtt{ieqn.I}\left( t \right) \\
\frac{\mathrm{d} \mathtt{reqn.R}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{reqn.\gamma} \mathtt{reqn.I}\left( t \right)
\end{align}
 \]</p><p>Note that the unknowns are forwarded by an equality relationship, while the parameters are forwarded through a relationship in their default values. The user of this model can then solve this model simply by specifying the values at the highest level:</p><pre><code class="language-julia hljs">sireqn_simple = structural_simplify(sir)

equations(sireqn_simple)</code></pre><p class="math-container">\[ \begin{align}
\frac{\mathrm{d} \mathtt{seqn.S}\left( t \right)}{\mathrm{d}t} &amp;= \frac{ - \mathtt{seqn.\beta} \mathtt{seqn.S}\left( t \right) \mathtt{seqn.I}\left( t \right)}{\mathtt{seqn.S}\left( t \right) + \mathtt{seqn.I}\left( t \right) + \mathtt{seqn.R}\left( t \right)} \\
\frac{\mathrm{d} \mathtt{ieqn.I}\left( t \right)}{\mathrm{d}t} &amp;= \frac{\mathtt{ieqn.\beta} \mathtt{ieqn.S}\left( t \right) \mathtt{ieqn.I}\left( t \right)}{\mathtt{ieqn.S}\left( t \right) + \mathtt{ieqn.I}\left( t \right) + \mathtt{ieqn.R}\left( t \right)} - \mathtt{ieqn.\gamma} \mathtt{ieqn.I}\left( t \right) \\
\frac{\mathrm{d} \mathtt{reqn.R}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{reqn.\gamma} \mathtt{reqn.I}\left( t \right)
\end{align}
 \]</p><pre><code class="language-julia hljs">## User Code

u0 = [seqn.S =&gt; 990.0,
    ieqn.I =&gt; 10.0,
    reqn.R =&gt; 0.0]

p = [β =&gt; 0.5
     γ =&gt; 0.25]

tspan = (0.0, 40.0)
prob = ODEProblem(sireqn_simple, u0, tspan, p, jac = true)
sol = solve(prob, Tsit5())
sol[reqn.R]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">18-element Vector{Float64}:
   0.0
   0.0014142401338982807
   0.015567426114815186
   0.1581830690301042
   1.0627159962527783
   3.3906766074140706
   7.785038823291203
  15.476270570721187
  30.10218714997552
  58.804758738885994
 116.64583849419007
 221.07867749201975
 368.86570081874015
 519.3989571642148
 655.4762160875096
 723.9496310639512
 772.9457994133218
 775.6835919143084</code></pre><h2 id="Tearing-Problem-Construction"><a class="docs-heading-anchor" href="#Tearing-Problem-Construction">Tearing Problem Construction</a><a id="Tearing-Problem-Construction-1"></a><a class="docs-heading-anchor-permalink" href="#Tearing-Problem-Construction" title="Permalink"></a></h2><p>Some system types (specifically <code>NonlinearSystem</code>) can be further reduced if <code>structural_simplify</code> has already been applied to them. This is done by using the alternative problem constructors (<code>BlockNonlinearProblem</code>). In these cases, the constructor uses the knowledge of the strongly connected components calculated during the process of simplification as the basis for building pre-simplified nonlinear systems in the implicit solving. In summary: these problems are structurally modified, but could be more efficient and more stable.</p><h2 id="Components-with-discontinuous-dynamics"><a class="docs-heading-anchor" href="#Components-with-discontinuous-dynamics">Components with discontinuous dynamics</a><a id="Components-with-discontinuous-dynamics-1"></a><a class="docs-heading-anchor-permalink" href="#Components-with-discontinuous-dynamics" title="Permalink"></a></h2><p>When modeling, e.g., impacts, saturations or Coulomb friction, the dynamic equations are discontinuous in either the unknown or one of its derivatives. This causes the solver to take very small steps around the discontinuity, and sometimes leads to early stopping due to <code>dt &lt;= dt_min</code>. The correct way to handle such dynamics is to tell the solver about the discontinuity by a root-finding equation, which can be modeling using <a href="../../systems/ODESystem/#ODESystem"><code>ODESystem</code></a>&#39;s event support. Please see the tutorial on <a href="../Events/#events">Callbacks and Events</a> for details and examples.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Variable_metadata/">« Symbolic Metadata</a><a class="docs-footer-nextpage" href="../Events/">Event Handling and Callback Functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Thursday 20 March 2025 15:01">Thursday 20 March 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
