<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Frequently Asked Questions · ModelingToolkit.jl</title><meta name="title" content="Frequently Asked Questions · ModelingToolkit.jl"/><meta property="og:title" content="Frequently Asked Questions · ModelingToolkit.jl"/><meta property="twitter:title" content="Frequently Asked Questions · ModelingToolkit.jl"/><meta name="description" content="Documentation for ModelingToolkit.jl."/><meta property="og:description" content="Documentation for ModelingToolkit.jl."/><meta property="twitter:description" content="Documentation for ModelingToolkit.jl."/><meta property="og:url" content="https://docs.sciml.ai/ModelingToolkit/stable/basics/FAQ/"/><meta property="twitter:url" content="https://docs.sciml.ai/ModelingToolkit/stable/basics/FAQ/"/><link rel="canonical" href="https://docs.sciml.ai/ModelingToolkit/stable/basics/FAQ/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ModelingToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ModelingToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../tutorials/ode_modeling/">Getting Started with ModelingToolkit.jl</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/acausal_components/">Acausal Component-Based Modeling</a></li><li><a class="tocitem" href="../../tutorials/nonlinear/">Modeling Nonlinear Systems</a></li><li><a class="tocitem" href="../../tutorials/initialization/">Initialization of Systems</a></li><li><a class="tocitem" href="../../tutorials/optimization/">Modeling Optimization Problems</a></li><li><a class="tocitem" href="../../tutorials/modelingtoolkitize/">Modelingtoolkitize: Automatically Translating Numerical to Symbolic Code</a></li><li><a class="tocitem" href="../../tutorials/programmatically_generating/">Programmatically Generating and Scripting Systems</a></li><li><a class="tocitem" href="../../tutorials/stochastic_diffeq/">Modeling with Stochasticity</a></li><li><a class="tocitem" href="../../tutorials/dynamic_optimization/">Solving Dynamic Optimization Problems</a></li><li><a class="tocitem" href="../../tutorials/discrete_system/">(Experimental) Modeling Discrete Systems</a></li><li><a class="tocitem" href="../../tutorials/parameter_identifiability/">Parameter Identifiability in ODE Models</a></li><li><a class="tocitem" href="../../tutorials/change_independent_variable/">Changing the independent variable of ODEs</a></li><li><a class="tocitem" href="../../tutorials/bifurcation_diagram_computation/">Bifurcation Diagrams</a></li><li><a class="tocitem" href="../../tutorials/attractors/">Multi- and Nonlocal- Continuation</a></li><li><a class="tocitem" href="../../tutorials/SampledData/">Clocks and Sampled-Data Systems</a></li><li><a class="tocitem" href="../../tutorials/domain_connections/">Domains</a></li><li><a class="tocitem" href="../../tutorials/callable_params/">Callable parameters and interpolating data</a></li><li><a class="tocitem" href="../../tutorials/linear_analysis/">Linear Analysis</a></li><li><a class="tocitem" href="../../tutorials/disturbance_modeling/">Disturbance and input modeling modeling</a></li><li><a class="tocitem" href="../../tutorials/fmi/">Importing FMUs</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Basic Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/higher_order/">Automatic Transformation of Nth Order ODEs to 1st Order ODEs</a></li><li><a class="tocitem" href="../../examples/spring_mass/">Component-Based Modeling of a Spring-Mass System</a></li><li><a class="tocitem" href="../../examples/modelingtoolkitize_index_reduction/">Automated Index Reduction of DAEs</a></li><li><a class="tocitem" href="../../examples/remake/">Optimizing through an ODE solve and re-creating MTK Problems</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Advanced Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/tearing_parallelism/">Exposing More Parallelism By Tearing Algebraic Equations in Systems</a></li><li><a class="tocitem" href="../../examples/sparse_jacobians/">Automated Sparse Analytical Jacobians</a></li><li><a class="tocitem" href="../../examples/perturbation/">Symbolic-Numeric Perturbation Theory for ODEs</a></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../API/System/">The <code>System</code> type</a></li><li><a class="tocitem" href="../../API/variables/">Symbolic variables and variable metadata</a></li><li><a class="tocitem" href="../../API/model_building/">Model building reference</a></li><li><a class="tocitem" href="../../API/problems/">Building and solving numerical problems</a></li><li><a class="tocitem" href="../../API/dynamic_opt/">-</a></li><li><a class="tocitem" href="../../API/codegen/">Code generation utilities</a></li><li><a class="tocitem" href="../../API/PDESystem/">PDESystem</a></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../Composition/">Composing Models and Building Reusable Components</a></li><li><a class="tocitem" href="../Events/">Event Handling and Callback Functions</a></li><li><a class="tocitem" href="../Linearization/">Linearization</a></li><li><a class="tocitem" href="../InputOutput/">Input output</a></li><li><a class="tocitem" href="../MTKLanguage/">ModelingToolkit Language: Modeling with <code>@mtkmodel</code>, <code>@connectors</code> and <code>@mtkcompile</code></a></li><li><a class="tocitem" href="../Validation/">Model Validation and Units</a></li><li><a class="tocitem" href="../Debugging/">Debugging</a></li><li><a class="tocitem" href="../DependencyGraphs/">Dependency Graphs</a></li><li><a class="tocitem" href="../Precompilation/">Working with Precompilation and Binary Building</a></li><li class="is-active"><a class="tocitem" href>Frequently Asked Questions</a><ul class="internal"><li><a class="tocitem" href="#Why-are-my-parameters-some-obscure-object?"><span>Why are my parameters some obscure object?</span></a></li><li><a class="tocitem" href="#How-do-I-use-non-numeric/array-valued-parameters?"><span>How do I use non-numeric/array-valued parameters?</span></a></li><li><a class="tocitem" href="#Getting-the-index-for-a-symbol"><span>Getting the index for a symbol</span></a></li><li><a class="tocitem" href="#Can-I-index-with-strings?"><span>Can I index with strings?</span></a></li><li><a class="tocitem" href="#Transforming-value-maps-to-arrays"><span>Transforming value maps to arrays</span></a></li><li><a class="tocitem" href="#How-do-I-handle-if-statements-in-my-symbolic-forms?"><span>How do I handle <code>if</code> statements in my symbolic forms?</span></a></li><li><a class="tocitem" href="#ERROR:-TypeError:-non-boolean-(Num)-used-in-boolean-context?"><span>ERROR: TypeError: non-boolean (Num) used in boolean context?</span></a></li><li><a class="tocitem" href="#Using-ModelingToolkit-with-Optimization-/-Automatic-Differentiation"><span>Using ModelingToolkit with Optimization / Automatic Differentiation</span></a></li><li class="toplevel"><a class="tocitem" href="#ERROR:-ArgumentError:-SymbolicUtils.BasicSymbolic{Real}[xˍt(t)]-are-missing-from-the-variable-map."><span>ERROR: ArgumentError: SymbolicUtils.BasicSymbolic{Real}[xˍt(t)] are missing from the variable map.</span></a></li><li><a class="tocitem" href="#Change-the-unknown-variable-vector-type"><span>Change the unknown variable vector type</span></a></li><li><a class="tocitem" href="#Using-a-custom-independent-variable"><span>Using a custom independent variable</span></a></li><li><a class="tocitem" href="#Ordering-of-tunable-parameters"><span>Ordering of tunable parameters</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../comparison/">Comparison of ModelingToolkit vs Equation-Based and Block Modeling Languages</a></li><li><a class="tocitem" href="../../internals/">Internal Details</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Basics</a></li><li class="is-active"><a href>Frequently Asked Questions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Frequently Asked Questions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/ModelingToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/ModelingToolkit.jl/blob/master/docs/src/basics/FAQ.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Frequently-Asked-Questions"><a class="docs-heading-anchor" href="#Frequently-Asked-Questions">Frequently Asked Questions</a><a id="Frequently-Asked-Questions-1"></a><a class="docs-heading-anchor-permalink" href="#Frequently-Asked-Questions" title="Permalink"></a></h1><h2 id="Why-are-my-parameters-some-obscure-object?"><a class="docs-heading-anchor" href="#Why-are-my-parameters-some-obscure-object?">Why are my parameters some obscure object?</a><a id="Why-are-my-parameters-some-obscure-object?-1"></a><a class="docs-heading-anchor-permalink" href="#Why-are-my-parameters-some-obscure-object?" title="Permalink"></a></h2><p>In ModelingToolkit.jl version 9, the parameter vector was replaced with a custom <code>MTKParameters</code> object, whose internals are intentionally undocumented and subject to change without a breaking release. This enables us to efficiently store and generate code for parameters of multiple types. To obtain parameter values use <a href="https://github.com/SciML/SymbolicIndexingInterface.jl/">SymbolicIndexingInterface.jl</a> or <a href="https://github.com/SciML/SciMLStructures.jl/">SciMLStructures.jl</a>. For example:</p><pre><code class="language-julia hljs">prob.ps[lorenz.β] # obtains the value of parameter `β`. Note the `.ps` instead of `.p`
getβ = getp(prob, lorenz.β) # returns a function that can fetch the value of `β`
getβ(sol) # can be used on any object that is based off of the same system
getβ(prob)</code></pre><p>Indexes into the <code>MTKParameters</code> object take the form of <code>ParameterIndex</code> objects, which are similarly undocumented. Following is the list of behaviors that should be relied on for <code>MTKParameters</code>:</p><ul><li>It implements the SciMLStructures interface.</li><li>It can be queried for parameters using functions returned from <code>SymbolicIndexingInterface.getp</code>.</li><li><code>getindex(::MTKParameters, ::ParameterIndex)</code> can be used to obtain the value of a parameter with the given index.</li><li><code>setindex!(::MTKParameters, value, ::ParameterIndex)</code> can be used to set the value of a parameter with the given index.</li><li><code>parameter_values(sys, sym)</code> will return a <code>ParameterIndex</code> object if <code>sys</code> has been <code>complete</code>d (through <code>mtkcompile</code>, <code>complete</code> or <code>@mtkcompile</code>).</li><li><code>copy(::MTKParameters)</code> is defined and duplicates the parameter object, including the memory used by the underlying buffers.</li></ul><p>Any other behavior of <code>MTKParameters</code> (other <code>getindex</code>/<code>setindex!</code> methods, etc.) is an undocumented internal and should not be relied upon.</p><h2 id="How-do-I-use-non-numeric/array-valued-parameters?"><a class="docs-heading-anchor" href="#How-do-I-use-non-numeric/array-valued-parameters?">How do I use non-numeric/array-valued parameters?</a><a id="How-do-I-use-non-numeric/array-valued-parameters?-1"></a><a class="docs-heading-anchor-permalink" href="#How-do-I-use-non-numeric/array-valued-parameters?" title="Permalink"></a></h2><p>In ModelingToolkit.jl version 9, parameters are required to have a <code>symtype</code> matching the type of their values. For example, this will error during problem construction:</p><pre><code class="language-julia hljs">@parameters p = [1, 2, 3]</code></pre><p>Since by default parameters have a <code>symtype</code> of <code>Real</code> (which is interpreted as <code>Float64</code>) but the default value given to it is a <code>Vector{Int}</code>. For array-valued parameters, use the following syntax:</p><pre><code class="language-julia hljs">@parameters p[1:n, 1:m]::T # `T` is the `eltype` of the parameter array
@parameters p::T # `T` is the type of the array</code></pre><p>The former approach is preferred, since the size of the array is known. If the array is not a <code>Base.Array</code> or the size is not known during model construction, the second syntax is required.</p><p>The same principle applies to any parameter type that is not <code>Float64</code>.</p><pre><code class="language-julia hljs">@parameters p1::Int # integer-valued
@parameters p2::Bool # boolean-valued
@parameters p3::MyCustomStructType # non-numeric
@parameters p4::ComponentArray{...} # non-standard array</code></pre><h2 id="Getting-the-index-for-a-symbol"><a class="docs-heading-anchor" href="#Getting-the-index-for-a-symbol">Getting the index for a symbol</a><a id="Getting-the-index-for-a-symbol-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-the-index-for-a-symbol" title="Permalink"></a></h2><p>Ordering of symbols is not guaranteed after symbolic transformations, and parameters are now stored in a custom <code>MTKParameters</code> object instead of a vector. Thus, values should be referred to by their name. For example <code>sol[lorenz.x]</code>. To obtain the index, use the following functions from <a href="https://github.com/SciML/SymbolicIndexingInterface.jl/">SymbolicIndexingInterface.jl</a>:</p><pre><code class="language-julia hljs">variable_index(sys, sym)
parameter_index(sys, sym)</code></pre><p>Note that while the variable index will be an integer, the parameter index is a struct of type <code>ParameterIndex</code> whose internals should not be relied upon.</p><h2 id="Can-I-index-with-strings?"><a class="docs-heading-anchor" href="#Can-I-index-with-strings?">Can I index with strings?</a><a id="Can-I-index-with-strings?-1"></a><a class="docs-heading-anchor-permalink" href="#Can-I-index-with-strings?" title="Permalink"></a></h2><p>Strings are not considered symbolic variables, and thus cannot directly be used for symbolic indexing. However, ModelingToolkit does provide a method to parse the string representation of a variable, given the system in which that variable exists.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ModelingToolkit.parse_variable-basics-FAQ" href="#ModelingToolkit.parse_variable-basics-FAQ"><code>ModelingToolkit.parse_variable</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">parse_variable(
    sys::ModelingToolkit.AbstractSystem,
    str::AbstractString
) -&gt; Any
</code></pre><p>Return the variable in <code>sys</code> referred to by its string representation <code>str</code>. Roughly supports the following CFG:</p><pre><code class="nohighlight hljs">varname                  = &quot;D(&quot; varname &quot;)&quot; | &quot;Differential(&quot; iv &quot;)(&quot; varname &quot;)&quot; | arrvar | maybe_dummy_var
arrvar                   = maybe_dummy_var &quot;[idxs...]&quot;
idxs                     = int | int &quot;,&quot; idxs
maybe_dummy_var          = namespacedvar | namespacedvar &quot;(&quot; iv &quot;)&quot; |
                           namespacedvar &quot;(&quot; iv &quot;)&quot; &quot;ˍ&quot; ts | namespacedvar &quot;ˍ&quot; ts |
                           namespacedvar &quot;ˍ&quot; ts &quot;(&quot; iv &quot;)&quot;
ts                       = iv | iv ts
namespacedvar            = ident &quot;₊&quot; namespacedvar | ident &quot;.&quot; namespacedvar | ident</code></pre><p>Where <code>iv</code> is the independent variable, <code>int</code> is an integer and <code>ident</code> is an identifier.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/ModelingToolkit.jl/blob/cd0395397395cd07874a11fa6746b3a0279daedc/src/systems/abstractsystem.jl#L2917-L2935">source</a></section></article><h2 id="Transforming-value-maps-to-arrays"><a class="docs-heading-anchor" href="#Transforming-value-maps-to-arrays">Transforming value maps to arrays</a><a id="Transforming-value-maps-to-arrays-1"></a><a class="docs-heading-anchor-permalink" href="#Transforming-value-maps-to-arrays" title="Permalink"></a></h2><p>ModelingToolkit.jl allows (and recommends) input maps like <code>[x =&gt; 2.0, y =&gt; 3.0]</code> because symbol ordering is not guaranteed. However, what if you want to get the lowered array? You can use the internal function <code>varmap_to_vars</code> for unknowns. and the <code>MTKParameters</code> constructor for parameters. For example:</p><pre><code class="language-julia hljs">unew = varmap_to_vars([x =&gt; 1.0, y =&gt; 2.0, z =&gt; 3.0], unknowns(sys))
pnew = ModelingToolkit.MTKParameters(sys, [β =&gt; 3.0, c =&gt; 10.0, γ =&gt; 2.0], unew)</code></pre><h2 id="How-do-I-handle-if-statements-in-my-symbolic-forms?"><a class="docs-heading-anchor" href="#How-do-I-handle-if-statements-in-my-symbolic-forms?">How do I handle <code>if</code> statements in my symbolic forms?</a><a id="How-do-I-handle-if-statements-in-my-symbolic-forms?-1"></a><a class="docs-heading-anchor-permalink" href="#How-do-I-handle-if-statements-in-my-symbolic-forms?" title="Permalink"></a></h2><p>For statements that are in the <code>if then else</code> form, use <code>Base.ifelse</code> from the to represent the code in a functional form. For handling direct <code>if</code> statements, you can use equivalent boolean mathematical expressions. For example, <code>if x &gt; 0 ...</code> can be implemented as just <code>(x &gt; 0) *</code>, where if <code>x &lt;= 0</code> then the boolean will evaluate to <code>0</code> and thus the term will be excluded from the model.</p><h2 id="ERROR:-TypeError:-non-boolean-(Num)-used-in-boolean-context?"><a class="docs-heading-anchor" href="#ERROR:-TypeError:-non-boolean-(Num)-used-in-boolean-context?">ERROR: TypeError: non-boolean (Num) used in boolean context?</a><a id="ERROR:-TypeError:-non-boolean-(Num)-used-in-boolean-context?-1"></a><a class="docs-heading-anchor-permalink" href="#ERROR:-TypeError:-non-boolean-(Num)-used-in-boolean-context?" title="Permalink"></a></h2><p>If you see the error:</p><pre><code class="nohighlight hljs">ERROR: TypeError: non-boolean (Num) used in boolean context</code></pre><p>then it&#39;s likely you are trying to trace through a function which cannot be directly represented in Julia symbols. The techniques to handle this problem, such as <code>@register_symbolic</code>, are described in detail <a href="https://symbolics.juliasymbolics.org/dev/manual/faq/#Transforming-my-function-to-a-symbolic-equation-has-failed.-What-do-I-do?-1">in the Symbolics.jl documentation</a>.</p><h2 id="Using-ModelingToolkit-with-Optimization-/-Automatic-Differentiation"><a class="docs-heading-anchor" href="#Using-ModelingToolkit-with-Optimization-/-Automatic-Differentiation">Using ModelingToolkit with Optimization / Automatic Differentiation</a><a id="Using-ModelingToolkit-with-Optimization-/-Automatic-Differentiation-1"></a><a class="docs-heading-anchor-permalink" href="#Using-ModelingToolkit-with-Optimization-/-Automatic-Differentiation" title="Permalink"></a></h2><p>If you are using ModelingToolkit inside a loss function and are having issues with mixing MTK with automatic differentiation, getting performance, etc… don&#39;t! Instead, use MTK outside the loss function to generate the code, and then use the generated code inside the loss function.</p><p>For example, let&#39;s say you were building ODEProblems in the loss function like:</p><pre><code class="language-julia hljs">function loss(p)
    prob = ODEProblem(sys, [], [p1 =&gt; p[1], p2 =&gt; p[2]])
    sol = solve(prob, Tsit5())
    sum(abs2, sol)
end</code></pre><p>Since <code>ODEProblem</code> on a MTK <code>sys</code> will have to generate code, this will be slower than caching the generated code, and will require automatic differentiation to go through the code generation process itself. All of this is unnecessary. Instead, generate the problem once outside the loss function, and update the parameter values inside the loss function:</p><pre><code class="language-julia hljs">prob = ODEProblem(sys, [], [p1 =&gt; p[1], p2 =&gt; p[2]])
function loss(p)
    # update parameters
    sol = solve(prob, Tsit5())
    sum(abs2, sol)
end</code></pre><p>If a subset of the parameters are optimized, <code>setp</code> from SymbolicIndexingInterface.jl should be used to generate an efficient function for setting parameter values. For example:</p><pre><code class="language-julia hljs">using SymbolicIndexingInterface

prob = ODEProblem(sys, [], [p1 =&gt; p[1], p2 =&gt; p[2]])
setter! = setp(sys, [p1, p2])
function loss(p)
    setter!(prob, p)
    sol = solve(prob, Tsit5())
    sum(abs2, sol)
end</code></pre><p><a href="https://github.com/SciML/SciMLStructures.jl/">SciMLStructures.jl</a> can be leveraged to obtain all the parameters for optimization using the <code>Tunable</code> portion. By default, all numeric or numeric array parameters are marked as tunable, unless explicitly marked as <code>tunable = false</code> in the variable metadata.</p><pre><code class="language-julia hljs">using SciMLStructures: replace!, Tunable

prob = ODEProblem(sys, [], [p1 =&gt; p[1], p2 =&gt; p[2]])
function loss(p)
    replace!(Tunable(), prob.p, p)
    sol = solve(prob, Tsit5())
    sum(abs2, sol)
end

p, replace, alias = SciMLStructures.canonicalize(Tunable(), prob.p)
# p is an `AbstractVector` which can be optimized
# if `alias == true`, then `p` aliases the memory used by `prob.p`, so
# changes to the array will be reflected in parameter values</code></pre><h1 id="ERROR:-ArgumentError:-SymbolicUtils.BasicSymbolic{Real}[xˍt(t)]-are-missing-from-the-variable-map."><a class="docs-heading-anchor" href="#ERROR:-ArgumentError:-SymbolicUtils.BasicSymbolic{Real}[xˍt(t)]-are-missing-from-the-variable-map.">ERROR: ArgumentError: SymbolicUtils.BasicSymbolic{Real}[xˍt(t)] are missing from the variable map.</a><a id="ERROR:-ArgumentError:-SymbolicUtils.BasicSymbolic{Real}[xˍt(t)]-are-missing-from-the-variable-map.-1"></a><a class="docs-heading-anchor-permalink" href="#ERROR:-ArgumentError:-SymbolicUtils.BasicSymbolic{Real}[xˍt(t)]-are-missing-from-the-variable-map." title="Permalink"></a></h1><p>This error can come up after running <code>mtkcompile</code> on a system that generates dummy derivatives (i.e. variables with <code>ˍt</code>).  For example, here even though all the variables are defined with initial values, the <code>ODEProblem</code> generation will throw an error that defaults are missing from the variable map.</p><pre><code class="language-julia hljs">using ModelingToolkit
using ModelingToolkit: t_nounits as t, D_nounits as D

sts = @variables x1(t)=0.0 x2(t)=0.0 x3(t)=0.0 x4(t)=0.0
eqs = [x1 + x2 + 1 ~ 0
       x1 + x2 + x3 + 2 ~ 0
       x1 + D(x3) + x4 + 3 ~ 0
       2 * D(D(x1)) + D(D(x2)) + D(D(x3)) + D(x4) + 4 ~ 0]
@named sys = System(eqs, t)
sys = mtkcompile(sys)
prob = ODEProblem(sys, [], (0, 1))</code></pre><p>We can solve this problem by using the <code>missing_variable_defaults()</code> function</p><pre><code class="language-julia hljs">prob = ODEProblem(sys, ModelingToolkit.missing_variable_defaults(sys), (0, 1))</code></pre><p>This function provides 0 for the default values, which is a safe assumption for dummy derivatives of most models.  However, the 2nd argument allows for a different default value or values to be used if needed.</p><pre><code class="nohighlight hljs">julia&gt; ModelingToolkit.missing_variable_defaults(sys, [1,2,3])
3-element Vector{Pair}:
  x1ˍt(t) =&gt; 1
 x2ˍtt(t) =&gt; 2
 x3ˍtt(t) =&gt; 3</code></pre><h2 id="Change-the-unknown-variable-vector-type"><a class="docs-heading-anchor" href="#Change-the-unknown-variable-vector-type">Change the unknown variable vector type</a><a id="Change-the-unknown-variable-vector-type-1"></a><a class="docs-heading-anchor-permalink" href="#Change-the-unknown-variable-vector-type" title="Permalink"></a></h2><p>Use the <code>u0_constructor</code> keyword argument to map an array to the desired container type. For example:</p><pre><code class="language-julia hljs">using ModelingToolkit, StaticArrays
using ModelingToolkit: t_nounits as t, D_nounits as D

sts = @variables x1(t) = 0.0
eqs = [D(x1) ~ 1.1 * x1]
@mtkcompile sys = System(eqs, t)
prob = ODEProblem{false}(sys, [], (0, 1); u0_constructor = x -&gt; SVector(x...))</code></pre><h2 id="Using-a-custom-independent-variable"><a class="docs-heading-anchor" href="#Using-a-custom-independent-variable">Using a custom independent variable</a><a id="Using-a-custom-independent-variable-1"></a><a class="docs-heading-anchor-permalink" href="#Using-a-custom-independent-variable" title="Permalink"></a></h2><p>When possible, we recommend <code>using ModelingToolkit: t_nounits as t, D_nounits as D</code> as the independent variable and its derivative. However, if you want to use your own, you can do so:</p><pre><code class="language-julia hljs">using ModelingToolkit

@independent_variables x
D = Differential(x)
@variables y(x)
@named sys = System([D(y) ~ x], x)</code></pre><h2 id="Ordering-of-tunable-parameters"><a class="docs-heading-anchor" href="#Ordering-of-tunable-parameters">Ordering of tunable parameters</a><a id="Ordering-of-tunable-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Ordering-of-tunable-parameters" title="Permalink"></a></h2><p>Tunable parameters are floating point parameters, not used in callbacks and not marked with <code>tunable = false</code> in their metadata. These are expected to be used with AD and optimization libraries. As such, they are stored together in one <code>Vector{T}</code>. To obtain the ordering of tunable parameters in this buffer, use:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ModelingToolkit.tunable_parameters-basics-FAQ" href="#ModelingToolkit.tunable_parameters-basics-FAQ"><code>ModelingToolkit.tunable_parameters</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">tunable_parameters(sys, p = parameters(sys; initial_parameters = true); default=true)</code></pre><p>Get all parameters of <code>sys</code> that are marked as <code>tunable</code>.</p><p>Keyword argument <code>default</code> indicates whether variables without <code>tunable</code> metadata are to be considered tunable or not.</p><p>Create a tunable parameter by</p><pre><code class="nohighlight hljs">@parameters u [tunable=true]</code></pre><p>For systems created with <code>split = true</code> (the default) and <code>default = true</code> passed to this function, the order of parameters returned is the order in which they are stored in the tunables portion of <code>MTKParameters</code>. Note that array variables will not be scalarized. To obtain the flattened representation of the tunables portion, call <code>Symbolics.scalarize(tunable_parameters(sys))</code> and concatenate the resulting arrays.</p><p>See also <a href="../../API/variables/#ModelingToolkit.getbounds"><code>getbounds</code></a>, <a href="../../API/variables/#ModelingToolkit.istunable"><code>istunable</code></a>, <a href="../../API/problems/#ModelingToolkit.MTKParameters"><code>MTKParameters</code></a>, <a href="../../API/model_building/#ModelingToolkit.complete"><code>complete</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/ModelingToolkit.jl/blob/cd0395397395cd07874a11fa6746b3a0279daedc/src/variables.jl#L377-L396">source</a></section></article><p>If you have an array in which a particular dimension is in the order of tunable parameters (e.g. the jacobian with respect to tunables) then that dimension of the array can be reordered into the required permutation using the symbolic variables:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ModelingToolkit.reorder_dimension_by_tunables!-basics-FAQ" href="#ModelingToolkit.reorder_dimension_by_tunables!-basics-FAQ"><code>ModelingToolkit.reorder_dimension_by_tunables!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reorder_dimension_by_tunables!(dest::AbstractArray, sys::AbstractSystem, arr::AbstractArray, syms; dim = 1)</code></pre><p>Assuming the order of values in dimension <code>dim</code> of <code>arr</code> correspond to the order of tunable parameters in the system, reorder them according to the order described in <code>syms</code>. <code>syms</code> must be a permutation of <code>tunable_parameters(sys)</code>. The result is written to <code>dest</code>. The <code>size</code> of <code>dest</code> and <code>arr</code> must be equal. Return <code>dest</code>.</p><p>See also: <a href="../../API/problems/#ModelingToolkit.MTKParameters"><code>MTKParameters</code></a>, <a href="../../API/System/#ModelingToolkit.tunable_parameters"><code>tunable_parameters</code></a>, <a href="../../API/problems/#ModelingToolkit.reorder_dimension_by_tunables"><code>reorder_dimension_by_tunables</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/ModelingToolkit.jl/blob/cd0395397395cd07874a11fa6746b3a0279daedc/src/systems/index_cache.jl#L643-L652">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ModelingToolkit.reorder_dimension_by_tunables-basics-FAQ" href="#ModelingToolkit.reorder_dimension_by_tunables-basics-FAQ"><code>ModelingToolkit.reorder_dimension_by_tunables</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reorder_dimension_by_tunables(sys::AbstractSystem, arr::AbstractArray, syms; dim = 1)</code></pre><p>Out-of-place version of <a href="../../API/problems/#ModelingToolkit.reorder_dimension_by_tunables!"><code>reorder_dimension_by_tunables!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/ModelingToolkit.jl/blob/cd0395397395cd07874a11fa6746b3a0279daedc/src/systems/index_cache.jl#L683-L687">source</a></section></article><p>For example:</p><pre><code class="language-julia hljs">using ModelingToolkit

@parameters p q[1:3] r[1:2, 1:2]

@named sys = System(Equation[], ModelingToolkit.t_nounits, [], [p, q, r])
sys = complete(sys)</code></pre><p class="math-container">\[ \begin{align}
\end{align}
 \]</p><p>The canonicalized tunables portion of <code>MTKParameters</code> will be in the order of tunables:</p><pre><code class="language-julia hljs">using SciMLStructures: canonicalize, Tunable

ps = MTKParameters(sys, [p =&gt; 1.0, q =&gt; [2.0, 3.0, 4.0], r =&gt; [5.0 6.0; 7.0 8.0]])
arr = canonicalize(Tunable(), ps)[1]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8-element Vector{Float64}:
 2.0
 3.0
 4.0
 1.0
 5.0
 7.0
 6.0
 8.0</code></pre><p>We can reorder this to contain the value for <code>p</code>, then all values for <code>q</code>, then for <code>r</code> using:</p><pre><code class="language-julia hljs">reorder_dimension_by_tunables(sys, arr, [p, q, r])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8-element Vector{Float64}:
 1.0
 2.0
 3.0
 4.0
 5.0
 7.0
 6.0
 8.0</code></pre><p>This also works with interleaved subarrays of symbolics:</p><pre><code class="language-julia hljs">reorder_dimension_by_tunables(sys, arr, [q[1], r[1, :], q[2], r[2, :], q[3], p])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8-element Vector{Float64}:
 2.0
 5.0
 6.0
 3.0
 7.0
 8.0
 4.0
 1.0</code></pre><p>And arbitrary dimensions of higher dimensional arrays:</p><pre><code class="language-julia hljs">highdimarr = stack([i * arr for i in 1:5]; dims = 1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×8 Matrix{Float64}:
  2.0   3.0   4.0  1.0   5.0   7.0   6.0   8.0
  4.0   6.0   8.0  2.0  10.0  14.0  12.0  16.0
  6.0   9.0  12.0  3.0  15.0  21.0  18.0  24.0
  8.0  12.0  16.0  4.0  20.0  28.0  24.0  32.0
 10.0  15.0  20.0  5.0  25.0  35.0  30.0  40.0</code></pre><pre><code class="language-julia hljs">reorder_dimension_by_tunables(sys, highdimarr, [q[1:2], r[1, :], q[3], r[2, :], p]; dim = 2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×8 Matrix{Float64}:
  2.0   3.0   5.0   6.0   4.0   7.0   8.0  1.0
  4.0   6.0  10.0  12.0   8.0  14.0  16.0  2.0
  6.0   9.0  15.0  18.0  12.0  21.0  24.0  3.0
  8.0  12.0  20.0  24.0  16.0  28.0  32.0  4.0
 10.0  15.0  25.0  30.0  20.0  35.0  40.0  5.0</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Precompilation/">« Working with Precompilation and Binary Building</a><a class="docs-footer-nextpage" href="../../comparison/">Comparison of ModelingToolkit vs Equation-Based and Block Modeling Languages »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Monday 16 June 2025 12:54">Monday 16 June 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
