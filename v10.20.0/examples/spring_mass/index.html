<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Component-Based Modeling of a Spring-Mass System · ModelingToolkit.jl</title><meta name="title" content="Component-Based Modeling of a Spring-Mass System · ModelingToolkit.jl"/><meta property="og:title" content="Component-Based Modeling of a Spring-Mass System · ModelingToolkit.jl"/><meta property="twitter:title" content="Component-Based Modeling of a Spring-Mass System · ModelingToolkit.jl"/><meta name="description" content="Documentation for ModelingToolkit.jl."/><meta property="og:description" content="Documentation for ModelingToolkit.jl."/><meta property="twitter:description" content="Documentation for ModelingToolkit.jl."/><meta property="og:url" content="https://docs.sciml.ai/ModelingToolkit/stable/examples/spring_mass/"/><meta property="twitter:url" content="https://docs.sciml.ai/ModelingToolkit/stable/examples/spring_mass/"/><link rel="canonical" href="https://docs.sciml.ai/ModelingToolkit/stable/examples/spring_mass/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ModelingToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ModelingToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../tutorials/ode_modeling/">Getting Started with ModelingToolkit.jl</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/acausal_components/">Acausal Component-Based Modeling</a></li><li><a class="tocitem" href="../../tutorials/nonlinear/">Modeling Nonlinear Systems</a></li><li><a class="tocitem" href="../../tutorials/initialization/">Initialization of Systems</a></li><li><a class="tocitem" href="../../tutorials/optimization/">Modeling Optimization Problems</a></li><li><a class="tocitem" href="../../tutorials/modelingtoolkitize/">Modelingtoolkitize: Automatically Translating Numerical to Symbolic Code</a></li><li><a class="tocitem" href="../../tutorials/programmatically_generating/">Programmatically Generating and Scripting Systems</a></li><li><a class="tocitem" href="../../tutorials/stochastic_diffeq/">Modeling with Stochasticity</a></li><li><a class="tocitem" href="../../tutorials/dynamic_optimization/">Solving Dynamic Optimization Problems</a></li><li><a class="tocitem" href="../../tutorials/discrete_system/">(Experimental) Modeling Discrete Systems</a></li><li><a class="tocitem" href="../../tutorials/parameter_identifiability/">Parameter Identifiability in ODE Models</a></li><li><a class="tocitem" href="../../tutorials/change_independent_variable/">Changing the independent variable of ODEs</a></li><li><a class="tocitem" href="../../tutorials/bifurcation_diagram_computation/">Bifurcation Diagrams</a></li><li><a class="tocitem" href="../../tutorials/attractors/">Multi- and Nonlocal- Continuation</a></li><li><a class="tocitem" href="../../tutorials/SampledData/">Clocks and Sampled-Data Systems</a></li><li><a class="tocitem" href="../../tutorials/domain_connections/">Domains</a></li><li><a class="tocitem" href="../../tutorials/callable_params/">Callable parameters and interpolating data</a></li><li><a class="tocitem" href="../../tutorials/linear_analysis/">Linear Analysis</a></li><li><a class="tocitem" href="../../tutorials/disturbance_modeling/">Disturbance and input modeling modeling</a></li><li><a class="tocitem" href="../../tutorials/fmi/">Importing FMUs</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox" checked/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Basic Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../higher_order/">Automatic Transformation of Nth Order ODEs to 1st Order ODEs</a></li><li class="is-active"><a class="tocitem" href>Component-Based Modeling of a Spring-Mass System</a><ul class="internal"><li><a class="tocitem" href="#Copy-Paste-Example"><span>Copy-Paste Example</span></a></li><li><a class="tocitem" href="#Explanation"><span>Explanation</span></a></li></ul></li><li><a class="tocitem" href="../modelingtoolkitize_index_reduction/">Automated Index Reduction of DAEs</a></li><li><a class="tocitem" href="../remake/">Optimizing through an ODE solve and re-creating MTK Problems</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Advanced Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../tearing_parallelism/">Exposing More Parallelism By Tearing Algebraic Equations in Systems</a></li><li><a class="tocitem" href="../sparse_jacobians/">Automated Sparse Analytical Jacobians</a></li><li><a class="tocitem" href="../perturbation/">Symbolic-Numeric Perturbation Theory for ODEs</a></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../API/System/">The <code>System</code> type</a></li><li><a class="tocitem" href="../../API/variables/">Symbolic variables and variable metadata</a></li><li><a class="tocitem" href="../../API/model_building/">Model building reference</a></li><li><a class="tocitem" href="../../API/problems/">Building and solving numerical problems</a></li><li><a class="tocitem" href="../../API/dynamic_opt/">Dynamic Optimization Solvers</a></li><li><a class="tocitem" href="../../API/codegen/">Code generation utilities</a></li><li><a class="tocitem" href="../../API/PDESystem/">PDESystem</a></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../basics/Composition/">Composing Models and Building Reusable Components</a></li><li><a class="tocitem" href="../../basics/Events/">Event Handling and Callback Functions</a></li><li><a class="tocitem" href="../../basics/Linearization/">Linearization</a></li><li><a class="tocitem" href="../../basics/InputOutput/">Input output</a></li><li><a class="tocitem" href="../../basics/MTKLanguage/">ModelingToolkit Language: Modeling with <code>@mtkmodel</code>, <code>@connectors</code> and <code>@mtkcompile</code></a></li><li><a class="tocitem" href="../../basics/Validation/">Model Validation and Units</a></li><li><a class="tocitem" href="../../basics/Debugging/">Debugging</a></li><li><a class="tocitem" href="../../basics/DependencyGraphs/">Dependency Graphs</a></li><li><a class="tocitem" href="../../basics/Precompilation/">Working with Precompilation and Binary Building</a></li><li><a class="tocitem" href="../../basics/FAQ/">Frequently Asked Questions</a></li></ul></li><li><a class="tocitem" href="../../comparison/">Comparison of ModelingToolkit vs Equation-Based and Block Modeling Languages</a></li><li><span class="tocitem">Internal Details</span><ul><li><a class="tocitem" href="../../internals/">Internal Details</a></li><li><a class="tocitem" href="../../internals/structural_transformation/">Structural Transformation</a></li><li><a class="tocitem" href="../../internals/bipartite_graph/">Bipartite Graphs</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li><a class="is-disabled">Basic Examples</a></li><li class="is-active"><a href>Component-Based Modeling of a Spring-Mass System</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Component-Based Modeling of a Spring-Mass System</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/ModelingToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/ModelingToolkit.jl/blob/master/docs/src/examples/spring_mass.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Component-Based-Modeling-of-a-Spring-Mass-System"><a class="docs-heading-anchor" href="#Component-Based-Modeling-of-a-Spring-Mass-System">Component-Based Modeling of a Spring-Mass System</a><a id="Component-Based-Modeling-of-a-Spring-Mass-System-1"></a><a class="docs-heading-anchor-permalink" href="#Component-Based-Modeling-of-a-Spring-Mass-System" title="Permalink"></a></h1><p>In this tutorial, we will build a simple component-based model of a spring-mass system. A spring-mass system consists of one or more masses connected by springs. <a href="https://en.wikipedia.org/wiki/Hooke%27s_law">Hooke&#39;s law</a> gives the force exerted by a spring when it is extended or compressed by a given distance. This specifies a differential-equation system where the acceleration of the masses is specified using the forces acting on them.</p><h2 id="Copy-Paste-Example"><a class="docs-heading-anchor" href="#Copy-Paste-Example">Copy-Paste Example</a><a id="Copy-Paste-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Copy-Paste-Example" title="Permalink"></a></h2><pre><code class="language-julia hljs">using ModelingToolkit, Plots, OrdinaryDiffEq, LinearAlgebra
using ModelingToolkit: t_nounits as t, D_nounits as D
using Symbolics: scalarize

function Mass(; name, m = 1.0, xy = [0.0, 0.0], u = [0.0, 0.0])
    ps = @parameters m = m
    sts = @variables pos(t)[1:2]=xy v(t)[1:2]=u
    eqs = scalarize(D.(pos) .~ v)
    System(eqs, t, [pos..., v...], ps; name)
end

function Spring(; name, k = 1e4, l = 1.0)
    ps = @parameters k=k l=l
    @variables x(t), dir(t)[1:2]
    System(Equation[], t, [x, dir...], ps; name)
end

function connect_spring(spring, a, b)
    [spring.x ~ norm(scalarize(a .- b))
     scalarize(spring.dir .~ scalarize(a .- b))]
end

function spring_force(spring)
    -spring.k .* scalarize(spring.dir) .* (spring.x - spring.l) ./ spring.x
end

m = 1.0
xy = [1.0, -1.0]
k = 1e4
l = 1.0
center = [0.0, 0.0]
g = [0.0, -9.81]
@named mass = Mass(m = m, xy = xy)
@named spring = Spring(k = k, l = l)

eqs = [connect_spring(spring, mass.pos, center)
       scalarize(D.(mass.v) .~ spring_force(spring) / mass.m .+ g)]

@named _model = System(eqs, t, [spring.x; spring.dir; mass.pos], [])
@named model = compose(_model, mass, spring)
sys = mtkcompile(model)

prob = ODEProblem(sys, [], (0.0, 3.0))
sol = solve(prob, Rosenbrock23())
plot(sol)</code></pre><img src="ee00fd79.svg" alt="Example block output"/><h2 id="Explanation"><a class="docs-heading-anchor" href="#Explanation">Explanation</a><a id="Explanation-1"></a><a class="docs-heading-anchor-permalink" href="#Explanation" title="Permalink"></a></h2><h3 id="Building-the-components"><a class="docs-heading-anchor" href="#Building-the-components">Building the components</a><a id="Building-the-components-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-components" title="Permalink"></a></h3><p>For each component, we use a Julia function that returns an <code>System</code>. At the top, we define the fundamental properties of a <code>Mass</code>: it has a mass <code>m</code>, a position <code>pos</code> and a velocity <code>v</code>. We also define that the velocity is the rate of change of position with respect to time.</p><pre><code class="language-julia hljs">function Mass(; name, m = 1.0, xy = [0.0, 0.0], u = [0.0, 0.0])
    ps = @parameters m = m
    sts = @variables pos(t)[1:2]=xy v(t)[1:2]=u
    eqs = scalarize(D.(pos) .~ v)
    System(eqs, t, [pos..., v...], ps; name)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Mass (generic function with 1 method)</code></pre><p>Note that this is an incompletely specified <code>System</code>. It cannot be simulated on its own, since the equations for the velocity <code>v[1:2](t)</code> are unknown. Notice the addition of a <code>name</code> keyword. This allows us to generate different masses with different names. A <code>Mass</code> can now be constructed as:</p><pre><code class="language-julia hljs">Mass(name = :mass1)</code></pre><p class="math-container">\[ \begin{align}
\frac{\mathrm{d} \mathtt{pos}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= v\_{1}\left( t \right) \\
\frac{\mathrm{d} \mathtt{pos}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= v\_{2}\left( t \right)
\end{align}
 \]</p><p>Or using the <code>@named</code> helper macro</p><pre><code class="language-julia hljs">@named mass1 = Mass()</code></pre><p class="math-container">\[ \begin{align}
\frac{\mathrm{d} \mathtt{pos}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= v\_{1}\left( t \right) \\
\frac{\mathrm{d} \mathtt{pos}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= v\_{2}\left( t \right)
\end{align}
 \]</p><p>Next, we build the spring component. It is characterized by the spring constant <code>k</code> and the length <code>l</code> of the spring when no force is applied to it. The state of a spring is defined by its current length and direction.</p><pre><code class="language-julia hljs">function Spring(; name, k = 1e4, l = 1.0)
    ps = @parameters k=k l=l
    @variables x(t), dir(t)[1:2]
    System(Equation[], t, [x, dir...], ps; name)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Spring (generic function with 1 method)</code></pre><p>We now define functions that help construct the equations for a mass-spring system. First, the <code>connect_spring</code> function connects a <code>spring</code> between two positions <code>a</code> and <code>b</code>. Note that <code>a</code> and <code>b</code> can be the <code>pos</code> of a <code>Mass</code>, or just a fixed position such as <code>[0., 0.]</code>. In that sense, the length of the spring <code>x</code> is given by the length of the vector <code>dir</code> joining <code>a</code> and <code>b</code>.</p><pre><code class="language-julia hljs">function connect_spring(spring, a, b)
    [spring.x ~ norm(scalarize(a .- b))
     scalarize(spring.dir .~ scalarize(a .- b))]
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">connect_spring (generic function with 1 method)</code></pre><p>Lastly, we define the <code>spring_force</code> function that takes a <code>spring</code> and returns the force exerted by this spring.</p><pre><code class="language-julia hljs">function spring_force(spring)
    -spring.k .* scalarize(spring.dir) .* (spring.x - spring.l) ./ spring.x
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">spring_force (generic function with 1 method)</code></pre><p>To create our system, we will first create the components: a mass and a spring. This is done as follows:</p><pre><code class="language-julia hljs">m = 1.0
xy = [1.0, -1.0]
k = 1e4
l = 1.0
center = [0.0, 0.0]
g = [0.0, -9.81]
@named mass = Mass(m = m, xy = xy)
@named spring = Spring(k = k, l = l)</code></pre><p class="math-container">\[ \begin{align}
\end{align}
 \]</p><p>We can now create the equations describing this system, by connecting <code>spring</code> to <code>mass</code> and a fixed point.</p><pre><code class="language-julia hljs">eqs = [connect_spring(spring, mass.pos, center)
       scalarize(D.(mass.v) .~ spring_force(spring) / mass.m .+ g)]</code></pre><p class="math-container">\[ \begin{align}
\mathtt{spring.x}\left( t \right) &amp;= \sqrt{\left|\mathtt{mass.pos}\_{2}\left( t \right)\right|^{2} + \left|\mathtt{mass.pos}\_{1}\left( t \right)\right|^{2}} \\
\mathtt{spring.dir}\_{1}\left( t \right) &amp;= \mathtt{mass.pos}\_{1}\left( t \right) \\
\mathtt{spring.dir}\_{2}\left( t \right) &amp;= \mathtt{mass.pos}\_{2}\left( t \right) \\
\frac{\mathrm{d} \mathtt{mass.v}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= \frac{ - \mathtt{spring.dir}\_{1}\left( t \right) \mathtt{spring.k} \left(  - \mathtt{spring.l} + \mathtt{spring.x}\left( t \right) \right)}{\mathtt{mass.m} \mathtt{spring.x}\left( t \right)} \\
\frac{\mathrm{d} \mathtt{mass.v}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= -9.81 + \frac{ - \mathtt{spring.dir}\_{2}\left( t \right) \mathtt{spring.k} \left(  - \mathtt{spring.l} + \mathtt{spring.x}\left( t \right) \right)}{\mathtt{mass.m} \mathtt{spring.x}\left( t \right)}
\end{align}
 \]</p><p>Finally, we can build the model using these equations and components.</p><pre><code class="language-julia hljs">@named _model = System(eqs, t, [spring.x; spring.dir; mass.pos], [])
@named model = compose(_model, mass, spring)</code></pre><p class="math-container">\[ \begin{align}
\mathtt{spring.x}\left( t \right) &amp;= \sqrt{\left|\mathtt{mass.pos}\_{2}\left( t \right)\right|^{2} + \left|\mathtt{mass.pos}\_{1}\left( t \right)\right|^{2}} \\
\mathtt{spring.dir}\_{1}\left( t \right) &amp;= \mathtt{mass.pos}\_{1}\left( t \right) \\
\mathtt{spring.dir}\_{2}\left( t \right) &amp;= \mathtt{mass.pos}\_{2}\left( t \right) \\
\frac{\mathrm{d} \mathtt{mass.v}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= \frac{ - \mathtt{spring.dir}\_{1}\left( t \right) \mathtt{spring.k} \left(  - \mathtt{spring.l} + \mathtt{spring.x}\left( t \right) \right)}{\mathtt{mass.m} \mathtt{spring.x}\left( t \right)} \\
\frac{\mathrm{d} \mathtt{mass.v}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= -9.81 + \frac{ - \mathtt{spring.dir}\_{2}\left( t \right) \mathtt{spring.k} \left(  - \mathtt{spring.l} + \mathtt{spring.x}\left( t \right) \right)}{\mathtt{mass.m} \mathtt{spring.x}\left( t \right)} \\
\frac{\mathrm{d} \mathtt{mass.pos}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{mass.v}\_{1}\left( t \right) \\
\frac{\mathrm{d} \mathtt{mass.pos}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{mass.v}\_{2}\left( t \right)
\end{align}
 \]</p><p>We can take a look at the equations in the model using the <code>equations</code> function.</p><pre><code class="language-julia hljs">equations(model)</code></pre><p class="math-container">\[ \begin{align}
\mathtt{spring.x}\left( t \right) &amp;= \sqrt{\left|\mathtt{mass.pos}\_{2}\left( t \right)\right|^{2} + \left|\mathtt{mass.pos}\_{1}\left( t \right)\right|^{2}} \\
\mathtt{spring.dir}\_{1}\left( t \right) &amp;= \mathtt{mass.pos}\_{1}\left( t \right) \\
\mathtt{spring.dir}\_{2}\left( t \right) &amp;= \mathtt{mass.pos}\_{2}\left( t \right) \\
\frac{\mathrm{d} \mathtt{mass.v}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= \frac{ - \mathtt{spring.dir}\_{1}\left( t \right) \mathtt{spring.k} \left(  - \mathtt{spring.l} + \mathtt{spring.x}\left( t \right) \right)}{\mathtt{mass.m} \mathtt{spring.x}\left( t \right)} \\
\frac{\mathrm{d} \mathtt{mass.v}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= -9.81 + \frac{ - \mathtt{spring.dir}\_{2}\left( t \right) \mathtt{spring.k} \left(  - \mathtt{spring.l} + \mathtt{spring.x}\left( t \right) \right)}{\mathtt{mass.m} \mathtt{spring.x}\left( t \right)} \\
\frac{\mathrm{d} \mathtt{mass.pos}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{mass.v}\_{1}\left( t \right) \\
\frac{\mathrm{d} \mathtt{mass.pos}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{mass.v}\_{2}\left( t \right)
\end{align}
 \]</p><p>The unknowns of this model are:</p><pre><code class="language-julia hljs">unknowns(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">7-element Vector{SymbolicUtils.BasicSymbolic{Real}}:
 spring₊x(t)
 (spring₊dir(t))[1]
 (spring₊dir(t))[2]
 (mass₊pos(t))[1]
 (mass₊pos(t))[2]
 (mass₊v(t))[1]
 (mass₊v(t))[2]</code></pre><p>And the parameters of this model are:</p><pre><code class="language-julia hljs">parameters(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Any}:
 mass₊m
 spring₊k
 spring₊l</code></pre><h3 id="Simplifying-and-solving-this-system"><a class="docs-heading-anchor" href="#Simplifying-and-solving-this-system">Simplifying and solving this system</a><a id="Simplifying-and-solving-this-system-1"></a><a class="docs-heading-anchor-permalink" href="#Simplifying-and-solving-this-system" title="Permalink"></a></h3><p>This system can be solved directly as a DAE using <a href="https://docs.sciml.ai/DiffEqDocs/stable/solvers/dae_solve/">one of the DAE solvers from DifferentialEquations.jl</a>. However, we can symbolically simplify the system first beforehand. Running <code>mtkcompile</code> eliminates unnecessary variables from the model to give the leanest numerical representation of the system.</p><pre><code class="language-julia hljs">sys = mtkcompile(model)
equations(sys)</code></pre><p class="math-container">\[ \begin{align}
\frac{\mathrm{d} \mathtt{mass.pos}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{mass.v}\_{2}\left( t \right) \\
\frac{\mathrm{d} \mathtt{mass.pos}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{mass.v}\_{1}\left( t \right) \\
\frac{\mathrm{d} \mathtt{mass.v}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= -9.81 + \frac{ - \mathtt{spring.dir}\_{2}\left( t \right) \mathtt{spring.k} \left(  - \mathtt{spring.l} + \mathtt{spring.x}\left( t \right) \right)}{\mathtt{mass.m} \mathtt{spring.x}\left( t \right)} \\
\frac{\mathrm{d} \mathtt{mass.v}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= \frac{ - \mathtt{spring.dir}\_{1}\left( t \right) \mathtt{spring.k} \left(  - \mathtt{spring.l} + \mathtt{spring.x}\left( t \right) \right)}{\mathtt{mass.m} \mathtt{spring.x}\left( t \right)}
\end{align}
 \]</p><p>We are left with only 4 equations involving 4 unknown variables (<code>mass.pos[1]</code>, <code>mass.pos[2]</code>, <code>mass.v[1]</code>, <code>mass.v[2]</code>). We can solve the system by converting it to an <code>ODEProblem</code>. Some observed variables are not expanded by default. To view the complete equations, one can do</p><pre><code class="language-julia hljs">full_equations(sys)</code></pre><p class="math-container">\[ \begin{align}
\frac{\mathrm{d} \mathtt{mass.pos}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{mass.v}\_{2}\left( t \right) \\
\frac{\mathrm{d} \mathtt{mass.pos}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= \mathtt{mass.v}\_{1}\left( t \right) \\
\frac{\mathrm{d} \mathtt{mass.v}\_{2}\left( t \right)}{\mathrm{d}t} &amp;= -9.81 + \frac{ - \mathtt{mass.pos}\_{2}\left( t \right) \mathtt{spring.k} \left(  - \mathtt{spring.l} + \sqrt{\left|\mathtt{mass.pos}\_{2}\left( t \right)\right|^{2} + \left|\mathtt{mass.pos}\_{1}\left( t \right)\right|^{2}} \right)}{\mathtt{mass.m} \sqrt{\left|\mathtt{mass.pos}\_{2}\left( t \right)\right|^{2} + \left|\mathtt{mass.pos}\_{1}\left( t \right)\right|^{2}}} \\
\frac{\mathrm{d} \mathtt{mass.v}\_{1}\left( t \right)}{\mathrm{d}t} &amp;= \frac{ - \mathtt{mass.pos}\_{1}\left( t \right) \mathtt{spring.k} \left(  - \mathtt{spring.l} + \sqrt{\left|\mathtt{mass.pos}\_{2}\left( t \right)\right|^{2} + \left|\mathtt{mass.pos}\_{1}\left( t \right)\right|^{2}} \right)}{\mathtt{mass.m} \sqrt{\left|\mathtt{mass.pos}\_{2}\left( t \right)\right|^{2} + \left|\mathtt{mass.pos}\_{1}\left( t \right)\right|^{2}}}
\end{align}
 \]</p><p>This is done as follows:</p><pre><code class="language-julia hljs">prob = ODEProblem(sys, [], (0.0, 3.0))
sol = solve(prob, Rosenbrock23())
plot(sol)</code></pre><img src="d5f24bc7.svg" alt="Example block output"/><p>What if we want the timeseries of a different variable? That information is not lost! Instead, <code>mtkcompile</code> simply changes unknown variables into <code>observed</code> variables.</p><pre><code class="language-julia hljs">observed(sys)</code></pre><p class="math-container">\[ \begin{align}
\mathtt{spring.dir}\_{2}\left( t \right) &amp;= \mathtt{mass.pos}\_{2}\left( t \right) \\
\mathtt{spring.x}\left( t \right) &amp;= \sqrt{\left|\mathtt{mass.pos}\_{2}\left( t \right)\right|^{2} + \left|\mathtt{mass.pos}\_{1}\left( t \right)\right|^{2}} \\
\mathtt{spring.dir}\_{1}\left( t \right) &amp;= \mathtt{mass.pos}\_{1}\left( t \right) \\
\mathtt{spring.dir}\left( t \right) &amp;= change\_origin\left( \left[
\begin{array}{c}
1 \\
\end{array}
\right], \left[
\begin{array}{c}
\mathtt{spring.dir}\_{1}\left( t \right) \\
\mathtt{spring.dir}\_{2}\left( t \right) \\
\end{array}
\right] \right)
\end{align}
 \]</p><p>These are explicit algebraic equations which can be used to reconstruct the required variables on the fly. This leads to dramatic computational savings since implicitly solving an ODE scales as O(n^3), so fewer unknowns are significantly better!</p><p>We can access these variables using the solution object. For example, let&#39;s retrieve the x-position of the mass over time:</p><pre><code class="language-julia hljs">sol[mass.pos[1]]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1319-element Vector{Float64}:
  1.0
  0.9999999998290586
  0.999999979316097
  0.9999978938357836
  0.9999783978213862
  0.9998928643735703
  0.9995883462116874
  0.9987722296999486
  0.9968207137116937
  0.9928640064195641
  ⋮
 -0.30114675885261316
 -0.28428264096485617
 -0.2775266600735379
 -0.27584817036973014
 -0.27911600339046494
 -0.28771394535229905
 -0.30336673708472106
 -0.32595748418231446
 -0.32969310657730083</code></pre><p>We can also plot the path of the mass:</p><pre><code class="language-julia hljs">plot(sol, idxs = (mass.pos[1], mass.pos[2]))</code></pre><img src="a6a6b73c.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../higher_order/">« Automatic Transformation of Nth Order ODEs to 1st Order ODEs</a><a class="docs-footer-nextpage" href="../modelingtoolkitize_index_reduction/">Automated Index Reduction of DAEs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 19 August 2025 10:02">Tuesday 19 August 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
